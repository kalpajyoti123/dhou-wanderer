<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wanderer Admin | Dashboard</title>
    <style>
        :root { --primary: #F56A6A; --dark: #1a1a1a; --bg: #f4f7f6; --success: #27ae60; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .admin-container { max-width: 1100px; margin: 0 auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 2px solid #eee; padding-bottom: 20px; }
        .cms-card { background: #f9f9f9; padding: 20px; border-radius: 15px; margin-bottom: 30px; border: 1px solid #eee; }
        .cms-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; align-items: end; }
        .cms-form input { padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 14px; }
        .btn-save { background: #2ecc71; color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        
        /* Modern Table & Buttons */
        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; margin-top: 20px; }
        th { text-align: left; padding: 15px; background: #f8f8f8; color: #888; font-size: 11px; text-transform: uppercase; }
        td { padding: 20px 15px; background: white; font-size: 14px; border-top: 1px solid #eee; border-bottom: 1px solid #eee; }
        td:first-child { border-left: 1px solid #eee; border-top-left-radius: 10px; border-bottom-left-radius: 10px; }
        td:last-child { border-right: 1px solid #eee; border-top-right-radius: 10px; border-bottom-right-radius: 10px; }
        
        .status-badge { padding: 5px 12px; border-radius: 50px; font-size: 11px; font-weight: bold; }
        .status-Confirmed { background: #d1fae5; color: #065f46; }

        .btn-action { padding: 8px 16px; border-radius: 8px; text-decoration: none; font-size: 12px; font-weight: 700; display: inline-block; transition: 0.2s; border: 1px solid transparent; }
        .btn-edit { background: #fff5f5; color: var(--primary); border-color: #ffe0e0; }
        .btn-edit:hover { background: var(--primary); color: white; border-color: var(--primary); }
        .btn-delete { background: white; color: #e74c3c; border-color: #fadbd8; margin-left: 5px; }
        .btn-delete:hover { background: #e74c3c; color: white; border-color: #e74c3c; }
        .btn-confirm { background: #e8f8f5; color: #27ae60; border-color: #d4efdf; }
        .btn-confirm:hover { background: #27ae60; color: white; border-color: #27ae60; }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="header">
            <h1>Admin Panel</h1>
            <div>
                <span style="background:white; padding:10px 20px; border-radius:30px; box-shadow:0 5px 15px rgba(0,0,0,0.05); font-weight:bold; color:var(--success); margin-right:10px;">üí∞ Revenue: ‚Çπ{{ "{:,}".format(revenue) }}</span>
                <a href="/" style="margin-left:20px; color:var(--primary); text-decoration:none;">‚Üê Site</a>
                <a href="/logout" style="margin-left:15px; color:#888; text-decoration:none; font-size:14px;">Logout</a>
            </div>
        </div>

        <h2>Add New Trip</h2>
        <div class="cms-card">
            <form class="cms-form" action="/admin/add-trip" method="POST" enctype="multipart/form-data">
                <input type="text" name="name" placeholder="Trip Name" required>
                <input type="number" name="price" placeholder="Price (INR)" required>
                <textarea name="description" placeholder="Trip Description (e.g. A 6-Day journey...)" rows="3" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px; font-family:inherit; font-size:14px; grid-column: 1 / -1;"></textarea>
                
                <div style="display:flex; flex-direction:column; gap:5px;">
                    <label style="font-size:12px; color:#888;">Trip Image:</label>
                    <input type="file" name="image_file" accept="image/*" required>
                </div>

                <input type="number" name="spots" placeholder="Total Spots" required>
                <button type="submit" class="btn-save">Upload Trip</button>
            </form>
            <p style="font-size:13px; color:#666; margin-top:15px; border-top:1px solid #eee; padding-top:10px;">‚ÑπÔ∏è <strong>Note:</strong> To add the detailed itinerary (days, descriptions, and images), create the trip first, then click the <strong>"Edit / Itinerary"</strong> button below.</p>
        </div>

        <h2>Active Trips</h2>
        <table>
            <thead><tr><th>Trip</th><th>Price</th><th>Spots</th><th>Action</th></tr></thead>
            <tbody>
                {% for trip in trips %}
                <tr>
                    <td>{{ trip.name }}</td>
                    <td>‚Çπ{{ "{:,}".format(trip.price|int) }}</td>
                    <td>{{ trip.spots }}</td>
                    <td>
                        <a href="/admin/edit-trip/{{ trip._id }}" class="btn-action btn-edit">‚úèÔ∏è Edit / Itinerary</a>
                        <a href="/admin/delete-trip/{{ trip._id }}" class="btn-action btn-delete" onclick="return confirm('Are you sure you want to delete this trip?');">üóëÔ∏è Delete</a>
                    </td>
                </tr>
                {% else %} <tr><td colspan="4" style="text-align:center; padding:20px;">No trips found.</td></tr>
                {% endfor %}
            </tbody>
        </table>

        <h2>Traveler Bookings</h2>
        <table>
            <thead><tr><th>Booked On</th><th>Travel Date</th><th>Traveler</th><th>Trip</th><th>Payment</th><th>Status</th><th>Actions</th></tr></thead>
            <tbody>
                {% for booking in bookings %}
                <tr>
                    <td>{{ booking.date }}</td>
                    <td>{{ booking.travel_date }}</td>
                    <td>{{ booking.name }}<br><small>{{ booking.email }}</small></td>
                    <td>{{ booking.trip }}</td>
                    <td>
                        {% if booking.payment_status == 'Paid' %}
                        <span class="status-badge" style="background:#d1fae5; color:#065f46;">Paid</span>
                        {% else %}
                        <span class="status-badge" style="background:#fee2e2; color:#991b1b;">Unpaid</span>
                        {% endif %}
                    </td>
                    <td><span class="status-badge status-{{ booking.status }}">{{ booking.status }}</span></td>
                    <td>
                        {% if booking.status != 'Confirmed' %}
                        <a href="/update-status/{{ booking._id }}/Confirmed" class="btn-action btn-confirm">‚úÖ Confirm</a>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</body>
</html>