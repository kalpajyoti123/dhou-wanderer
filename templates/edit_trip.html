<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Trip | Wanderer Admin</title>
    <style>
        :root { --primary: #F56A6A; --dark: #1a1a1a; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .admin-container { width: 100%; max-width: 500px; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        h2 { margin-top: 0; color: var(--dark); text-align: center; }
        .cms-form { display: flex; flex-direction: column; gap: 20px; margin-top: 20px; }
        .form-group { display: flex; flex-direction: column; gap: 8px; }
        label { font-size: 12px; font-weight: bold; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        input { padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; width: 100%; box-sizing: border-box; }
        input:focus { border-color: var(--primary); outline: none; }
        .btn-save { background: var(--primary); color: white; border: none; padding: 15px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 16px; margin-top: 10px; transition: 0.3s; }
        .btn-save:hover { background: var(--dark); }
        .back-link { display: block; text-align: center; margin-top: 20px; color: #888; text-decoration: none; font-size: 14px; }
        .current-img { width: 100px; height: 60px; object-fit: cover; border-radius: 5px; margin-top: 5px; border: 1px solid #eee; }
        
        /* Itinerary Styles */
        .day-block { background: #f9f9f9; padding: 20px; border-radius: 12px; border: 1px solid #eee; margin-bottom: 15px; position: relative; }
        .day-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-weight: bold; color: var(--primary); }
        .btn-add { background: var(--dark); color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; cursor: pointer; margin-bottom: 20px; }
        .btn-remove { background: #ff4757; color: white; border: none; padding: 5px 12px; border-radius: 5px; cursor: pointer; font-size: 12px; }
    </style>
</head>
<body>
    <div class="admin-container">
        <h2>Edit Trip Details</h2>
        <form class="cms-form" method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label>Trip Name</label>
                <input type="text" name="name" value="{{ trip.name }}" required>
            </div>

            <div class="form-group">
                <label>Trip Description</label>
                <textarea name="description" rows="4" style="width:100%; padding:12px; border:1px solid #ddd; border-radius:8px; font-family:inherit;">{{ trip.description }}</textarea>
            </div>
            
            <div class="form-group">
                <label>Price (INR)</label>
                <input type="number" name="price" value="{{ trip.price }}" required>
            </div>

            <div class="form-group">
                <label>Total Spots</label>
                <input type="number" name="spots" value="{{ trip.spots }}" required>
            </div>

            <div class="form-group">
                <label>Update Image (Optional)</label>
                <input type="file" name="image_file" accept="image/*">
                {% if trip.image %}
                <div>
                    <small style="color:#999;">Current Image:</small><br>
                    <img src="{{ trip.image if 'http' in trip.image else '/static/wp-content/uploads/2021/01/' + trip.image }}" class="current-img">
                </div>
                {% endif %}
            </div>

            <hr style="border: 0; border-top: 1px solid #eee; margin: 20px 0;">
            
            <h3>Itinerary Management</h3>
            <div id="itinerary-wrapper">
                {% if trip.itinerary %}
                    {% for day in trip.itinerary %}
                    <div class="day-block">
                        <div class="day-header">
                            <span>Day {{ loop.index }}</span>
                            <button type="button" class="btn-remove" onclick="removeDay(this)">Remove</button>
                        </div>
                        <input type="hidden" name="day_indices" value="{{ loop.index }}">
                        
                        <div class="form-group">
                            <label>Day Title</label>
                            <input type="text" name="day_title_{{ loop.index }}" value="{{ day.title }}" placeholder="e.g. Arrival in Mechuka" required>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <textarea name="day_desc_{{ loop.index }}" rows="3" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px; font-family:inherit;">{{ day.description }}</textarea>
                        </div>
                        <div class="form-group">
                            <label>Day Image</label>
                            <input type="file" name="day_image_{{ loop.index }}">
                            <input type="hidden" name="existing_day_img_{{ loop.index }}" value="{{ day.image }}">
                            {% if day.image %}
                            <img src="{{ day.image if 'http' in day.image else '/static/wp-content/uploads/2021/01/' + day.image }}" class="current-img" style="height:40px;">
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                {% endif %}
            </div>
            
            <button type="button" class="btn-add" onclick="addDay()">+ Add Day</button>

            <button type="submit" class="btn-save">Save Changes</button>
        </form>
        <a href="/admin-dashboard" class="back-link">Cancel & Go Back</a>
    </div>

    <script>
        // Initialize counter based on existing days to avoid ID conflicts
        let dayIndexCounter = {{ trip.itinerary|length if trip.itinerary else 0 }};

        function addDay() {
            dayIndexCounter++;
            const wrapper = document.getElementById('itinerary-wrapper');
            const div = document.createElement('div');
            div.className = 'day-block';
            div.innerHTML = `
                <div class="day-header">
                    <span>New Day</span>
                    <button type="button" class="btn-remove" onclick="removeDay(this)">Remove</button>
                </div>
                <input type="hidden" name="day_indices" value="${dayIndexCounter}">
                <div class="form-group">
                    <label>Day Title</label>
                    <input type="text" name="day_title_${dayIndexCounter}" placeholder="e.g. Trek to Lake" required>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea name="day_desc_${dayIndexCounter}" rows="3" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:8px; font-family:inherit;"></textarea>
                </div>
                <div class="form-group">
                    <label>Day Image</label>
                    <input type="file" name="day_image_${dayIndexCounter}">
                </div>
            `;
            wrapper.appendChild(div);
        }

        function removeDay(btn) {
            btn.closest('.day-block').remove();
        }
    </script>
</body>
</html>